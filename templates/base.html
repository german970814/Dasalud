{% load i18n waffle_tags %}

<!DOCTYPE html>
<html lang="es">
    <head>
        <title>Dasalud</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- Load webcomponents-loader.js to check and load any polyfills your browser needs -->
        <script src="/static/bower_components/apollo-client/build/apollo-client.js"></script>
        <script src="/static/bower_components/webcomponentsjs/webcomponents-loader.js"></script>
        <link rel="import" href="/static/elements.html">
        {% block imports %}{% endblock imports %}

        <custom-style>
            <style is="custom-style">
                body {
                    margin: 0;
                    font-family: 'Roboto', 'Noto', sans-serif;
                    background-color: #f1f1f1;

                    --app-primary-color: #4285f4;
                    --app-secondary-color: black;
                }

                a {
                    text-decoration: none;
                    color: inherit;
                }

                app-header {
                    color: #fff;
                    background-color: var(--app-primary-color);
                }

                app-header paper-icon-button {
                    --paper-icon-button-ink-color: white;
                }

                search-box {
                    flex: 2;
                }

                app-toolbar span {
                    flex: 1;
                }

                main {
                    padding: 24px;
                }

                paper-button {
                    background: var(--app-primary-color);
                    color: white;
                }

                .card {
                    padding: 16px;
                    color: #757575;
                    border-radius: 5px;
                    background-color: #fff;
                    box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
                }

                .header-title {
                    margin-bottom: 1rem;
                    padding: 1rem 1rem 0;
                    position: relative;
                }

                .header-title > h1 {
                    margin: 0;
                    color: #676767;
                    line-height: 100%;
                    font-weight: 400;
                    font-size: 1.15rem;
                    text-transform: uppercase;
                }

                .header-title > small {
                    font-size: 1rem;
                    display: block;
                    margin-top: .8rem;
                    color: #959595;
                }
                
            </style>    
        </custom-style>

        {% block css %}{% endblock css %}
    </head>
    <body>
        <paper-toast id="baseToast"></paper-toast>
        <graphql-client config='{"uri": "{% url 'graphql' %}", "opts": { "credentials": "same-origin" }}'></graphql-client>
        <app-drawer-layout force-narrow fullbleed id="drawerLayout">
            <app-drawer slot="drawer">
                <app-menu selected="0">
                    {% if perms.pacientes.add_paciente %}
                    <a class="app-menu-item" href="{% url 'pacientes:crear' %}">
                        <app-menu-icon-item icon="my-icons:people">{% trans "Crear paciente" %}</app-menu-icon-item>
                    </a>                      
                    {% endif %}
                    <a class="app-menu-item" href="{% url 'agenda:listar' %}">
                        <app-menu-icon-item icon="my-icons:people">{% trans "Agenda" %}</app-menu-icon-item>
                    </a>
                    {% switch "citas" %}
                        {% if perms.agenda.add_horario_atencion %}
                        <a class="app-menu-item" href="{% url 'agenda:horario-atencion' %}">
                            <app-menu-icon-item icon="my-icons:people">{% trans "Horario de atenci√≥n" %}</app-menu-icon-item>
                        </a>                    
                        {% endif %}
                        {% if perms.agenda.add_cita %}
                        <a class="app-menu-item" href="{% url 'agenda:citas' %}">
                            <app-menu-icon-item icon="my-icons:people">{% trans "Agendar citas" %}</app-menu-icon-item>
                        </a>                    
                        <a class="app-menu-item" href="{% url 'agenda:citas-multiple' %}">
                            <app-menu-icon-item icon="my-icons:people">{% trans "Agendar citas multiple" %}</app-menu-icon-item>
                        </a>  
                        {% endif %}
                    {% endswitch %}
                </app-menu>
            </app-drawer>

            <app-header-layout has-scrolling-region>
                <app-header slot="header" condenses fixed effects="waterfall">
                    <app-toolbar>
                        <paper-icon-button drawer-toggle icon="my-icons:menu"></paper-icon-button>
                        <div main-title>DASALUD</div>
                        <search-box placeholder="Buscar pacientes"></search-box>
                        <span></span>
                        <a href="{% url 'logout' %}" tabindex="-1">
                            <paper-icon-button icon="my-icons:exit-to-app"></paper-icon-button>
                        </a>
                    </app-toolbar>
                </app-header>

                <main>
                    {% block content %}{% endblock content %}
                </main>
            </app-header-layout>
        </app-drawer-layout>

        {% block dialogs %}{% endblock dialogs %}

        <script>
            (function() {
                document.querySelector('search-box').addEventListener('enter', function(e) {
                    window.location = '{% url "pacientes:listar" %}?search=' + e.detail;
                });

                const toast = document.getElementById('baseToast');
                document.body.addEventListener('notify-toast', function(e) {
                    toast.text = e.detail.text;
                    setToastStyle(toast);
                    toast.open();
                });

                document.body.addEventListener('notify-toast-error', function(e) {
                    toast.text = e.detail.text;
                    setErrorStyle(toast);
                    toast.open();
                });

                document.body.addEventListener('notify-toast-form-error', function() {
                    toast.text = 'Hubo un error en el formulario por favor verifica.';
                    setErrorStyle(toast);
                    toast.open();
                });

                function setToastStyle(toast, backgroundColor, color) {
                    toast.style.setProperty('--paper-toast-background-color', backgroundColor || '#323232');
                    toast.style.setProperty('--paper-toast-color', color || '#f1f1f1');
                }

                function setErrorStyle(toast) {
                    toast.style.setProperty('--paper-toast-background-color', getComputedStyle(document.body).getPropertyValue('--error-color'));
                    toast.style.setProperty('--paper-toast-color', 'white');
                }
            })();            
        </script>

        {% block js %}{% endblock js %}
    </body>
</html>